---
applyTo: "**/codeGen/**"
---

# Code Generation Instructions - beamOS

## Overview

The `/codeGen` folder contains **generated code** that should NOT be manually edited. All files in this directory are automatically generated by running the code generation script.

## ⚠️ CRITICAL: Do Not Edit Generated Files

**All files in the `/codeGen` directory are auto-generated.** Any manual changes will be overwritten when the code generation script runs.

### Generated Projects:
- `BeamOs.CodeGen.ApiGenerator/` - The code generator itself
- `BeamOs.CodeGen.EditorApi/` - Generated Editor API clients (C# and TypeScript)
- `BeamOs.CodeGen.StructuralAnalysisApiClient/` - Generated Structural Analysis API clients (C#, TypeScript, and JavaScript)
- `BeamOs.CodeGen.TestModelBuilderGenerator/` - Generated test model builders

## How to Regenerate Code

To regenerate all API clients and related code:

```bash
# From the repository root
./scripts/codegen.sh
```

This script:
1. Runs the `BeamOs.CodeGen.ApiGenerator` project with the `CODEGEN=true` flag
2. Generates API clients in multiple languages (C#, TypeScript, and JavaScript)
3. Creates corresponding JSON serialization options
4. Updates test model builders

## What Gets Generated

The code generator creates:

### API Clients
- **EditorApi** (C# + TypeScript) - For editor interactions
- **StructuralAnalysisApi** (C# + TypeScript + JavaScript) - For structural analysis operations
- **SpeckleConnectorApi** (C# + TypeScript) - For Speckle 3D integration
- **AiApi** (C# only) - For AI-powered features

### Supporting Files
- JSON serialization options (`.JsonOptions.cs`)
- Global using statements (`GlobalUsings.cs`)
- TypeScript definitions (`.ts`)
- JavaScript bundles (`.js` and `.js.map`)
- Package configuration (`package.json`, `tsconfig.json`)

## When to Regenerate

Regenerate the code when:
- API endpoints are added, modified, or removed
- Request/response models change
- Contract interfaces are updated
- New API projects are added to the solution

## Build Integration

The code generation is integrated into the build process:
- The generator project includes special `CODEGEN=true` compile-time flag handling
- Some assembly conflicts during generation are expected and can be ignored
- Generated files are committed to source control for consistency

## Troubleshooting

**Error: Assembly conflicts with GenerateServiceRegistrationsAttribute**
- This is expected during code generation builds
- The warnings can be safely ignored

**Generated files missing or outdated**
- Run `./scripts/codegen.sh` to regenerate all files
- Ensure the BeamOs.CodeGen.ApiGenerator project builds successfully

**TypeScript/JavaScript files not updating**
- Check that the generator includes your API in the `generators` array in `Program.cs`
- Verify the API project exposes the necessary endpoints for generation

## Adding New API Generators

To add a new API generator:
1. Create a new generator class implementing `IApiGenerator`
2. Add it to the `generators` array in `BeamOs.CodeGen.ApiGenerator/Program.cs`
3. Run `./scripts/codegen.sh` to generate the new client code

**Remember**: Never manually edit files in `/codeGen` - always use the code generation script to update them.