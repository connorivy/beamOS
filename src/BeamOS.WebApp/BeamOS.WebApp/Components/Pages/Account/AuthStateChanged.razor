@page "/auth-state-changed"
@layout FullScreenLayout

@inject NavigationManager NavagationManager
@inject ILocalStorageService localStorageService
@inject IHttpContextAccessor httpContextAccessor
@* @attribute [Authorize] *@

@* @rendermode render mode must be static (default value) *@
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<div class="p-4">
    <h3>Authenticating ...</h3>
</div>

@code {
    [SupplyParameterFromQuery]
    public string? ReturnUrl { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (httpContextAccessor.HttpContext?.Request.Cookies["Authorization"] is string accessToken)
        {
            await localStorageService.SetItemAsync("Authorization", accessToken);
        }

        if (httpContextAccessor.HttpContext?.Request.Cookies["Refresh"] is string refreshToken)
        {
            await localStorageService.SetItemAsync("Refresh", refreshToken);
        }

        NavagationManager.NavigateTo(ReturnUrl ?? "/");
    }
}
