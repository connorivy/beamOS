@page "/models/{ModelId:guid}"

@using BeamOs.CodeGen.EditorApi
@using BeamOs.WebApp.Components.Features.Editor
@using BeamOs.WebApp.Components.Features.SelectionInfo
@using BeamOs.WebApp.Components.Features.StructuralApi
@using BeamOs.WebApp.EditorCommands
@using Fluxor.Blazor.Web.Components
@using MudBlazor

@inherits FluxorComponent

<PageTitle>Editor</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Gutters="false" Class="relative h-full w-full">
    <EditorComponent Class="h-full" @ref="editorComponent" ModelId="@ModelId" IsReadOnly="false"></EditorComponent>
    @if (this.editorComponent is not null && this.State.Value.LoadedModelId is Guid modelId)
    {
        <StructuralApiComponent Class="absolute left-0 top-0 w-1/4 p-4" ModelId="@modelId" CanvasId="@editorComponent.CanvasId"></StructuralApiComponent>

        <SelectionInfoComponent ModelId="@modelId" SelectedObjects="this.State.Value.SelectedObjects" Class="absolute right-0 top-0 w-1/4 p-4" CanvasId="@editorComponent.CanvasId"></SelectionInfoComponent>
    }
</MudContainer>

@code {
    [Parameter]
    public Guid ModelId { get; set; }

    [Inject]
    private IState<EditorComponentState> State { get; init; }

    private EditorComponent? editorComponent
    {
        get;
        set
        {
            field = value;
            StateHasChanged();
        }
    }

    // protected override void OnInitialized()
    // {
    //     base.OnInitialized();

    //     this.SubscribeToAction<EditorLoadingEnd>(_ =>
    //     {
    //         this.State.Select(s => s.EditorState[this.editorComponent.CanvasId]);
    //         this.StateHasChanged();
    //     });
    // }
}
